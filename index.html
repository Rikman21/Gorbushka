<script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        const sellers = [123456789]; 
        const userId = tg.initDataUnsafe.user?.id;

        // –í–ê–ñ–ù–û: –í–ø–∏—à–∏—Ç–µ —Å—é–¥–∞ –°–í–û–ô ID –≤ –ø–æ–ª–µ 'id', —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü—É!
        const mockOffers = [
            { id: @GaFoks, username: 'Dmitry_Store', price: 105000, rating: '‚≠êÔ∏è 4.9' },
            { id: 987654321, username: 'Apple_Rostov', price: 106500, rating: '‚≠êÔ∏è 5.0' },
            { id: 555555555, username: 'Ivan_Gadget', price: 104000, rating: '‚≠êÔ∏è 4.8' }
        ];
        
        // ... (–ö–∞—Ç–∞–ª–æ–≥ catalog –∏ —Å—Ç—Ä–∞–Ω—ã countries –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ –∂–µ, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞) ...
        // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ —è –∏—Ö —Ç—É—Ç —Å–≤–µ—Ä–Ω—É–ª, –Ω–æ –≤ —Ñ–∞–π–ª –≤—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏!
        const catalog = {
            'iPhone': { 'iPhone 16 Pro': { mem: ['128','256'], col: ['Black'], net: ['2 Sim'] } } // –í–µ—Ä–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫!
        };
        const countries = [{ name: '–†–°–¢', flag: 'üá∑üá∫' }]; // –í–µ—Ä–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫!

        let sel = { mode: '', cat: '', mod: '', mem: '', col: '', net: '', ctry: '' };
        let history = [];

        function init() {
            const savedRole = localStorage.getItem('user_role');
            if (!savedRole) showScreen('screen-welcome');
            else { updateInterface(savedRole); showScreen('screen-lk'); }
        }

        function setRole(role) {
            if (role === 'seller' && !sellers.includes(userId)) return alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞");
            localStorage.setItem('user_role', role);
            updateInterface(role);
            showScreen('screen-lk');
        }

        function updateInterface(role) {
            document.getElementById('user-name').innerText = "–õ–ö - " + (tg.initDataUnsafe.user?.first_name || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å");
            document.getElementById('btn-buy').style.display = (role === 'buyer') ? 'block' : 'none';
            document.getElementById('btn-price').style.display = (role === 'seller') ? 'block' : 'none';
        }

        function showScreen(id) {
            ['screen-welcome', 'screen-lk', 'screen-flow', 'screen-offers', 'screen-price'].forEach(s => document.getElementById(s).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // ... (–§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ goBack, renderCats –∏ —Ç.–¥. –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        // –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —Ñ–∞–π–ª–∞

        function startFlow(mode) {
            sel.mode = mode;
            history = ['lk'];
            // –¢—É—Ç –≤—ã–∑–æ–≤–∏—Ç–µ renderCats(), –∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ
            // (–¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä–∞ —è –ø—Ä–æ–ø—É—Å–∫–∞—é –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∞)
        }

        // --- –ì–õ–ê–í–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –ó–î–ï–°–¨ ---

        function finishFlow(ctry) {
            sel.ctry = ctry;
            // –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
            const product = `${sel.mod} ${sel.mem}Gb ${sel.col} (${sel.net}) [${sel.ctry}]`;
            sel.productName = product; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º

            if (sel.mode === 'buy') {
                renderOffers(product);
            } else {
                document.getElementById('price-product-name').innerText = product;
                showScreen('screen-price');
            }
        }

        function renderOffers(productName) {
            document.getElementById('offers-subtitle').innerText = productName;
            let h = '';
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º (–∏–º–∏—Ç–∞—Ü–∏—è)
            mockOffers.sort((a, b) => a.price - b.price);

            mockOffers.forEach(offer => {
                // –ö–Ω–æ–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç requestBuy, –ø–µ—Ä–µ–¥–∞–≤–∞—è ID –ø—Ä–æ–¥–∞–≤—Ü–∞ –∏ —Ü–µ–Ω—É
                h += `
                <div class="offer-card">
                    <div class="offer-info">
                        <div class="offer-price">${offer.price.toLocaleString()} ‚ÇΩ</div>
                        <div class="offer-seller">üë§ @${offer.username}</div>
                        <div style="font-size:12px; color:#ffcc00">${offer.rating}</div>
                    </div>
                    <button class="btn-buy-small" onclick="requestBuy(${offer.id}, '${offer.username}', ${offer.price})">–ö—É–ø–∏—Ç—å</button>
                </div>`;
            });
            document.getElementById('offers-list').innerHTML = h;
            showScreen('screen-offers');
        }

        function requestBuy(sellerId, sellerUsername, price) {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
            // –§–æ—Ä–º–∞—Ç: REQ_BUY | ID_–ü—Ä–æ–¥–∞–≤—Ü–∞ | –ù–∏–∫_–ü—Ä–æ–¥–∞–≤—Ü–∞ | –¢–æ–≤–∞—Ä | –¶–µ–Ω–∞
            const data = `REQ_BUY|${sellerId}|${sellerUsername}|${sel.productName}|${price}`;
            tg.sendData(data);
            tg.close();
        }

        function finishPrice() {
            const price = document.getElementById('price-input').value;
            if (!price) return alert("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É");
            tg.sendData(`NEW_PRICE|${document.getElementById('price-product-name').innerText}|${price}`);
            tg.close();
        }
        
        // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥) ...
        // –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∞ (renderCats, selCat –∏ —Ç.–¥.)
    </script>
